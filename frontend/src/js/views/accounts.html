
<div class="oj-hybrid-padding">
  
  <!-- Page Header -->
  <div class="oj-flex oj-sm-align-items-center oj-sm-margin-4x-bottom">
    <div class="oj-flex-item">
      <h1 class="oj-header-border">Account Management</h1>
      <p class="oj-text-color-secondary">Manage customer accounts and balances</p>
    </div>
    <div class="oj-flex-item oj-sm-flex-initial">
      <oj-button id="addAccountBtn" 
                 chroming="callToAction" 
                 on-oj-action="[[openAddDialog]]"
                 disabled="[[isLoading()]]">
        <span slot="startIcon" class="oj-ux-ico-add"></span>
        Create Account
      </oj-button>
    </div>
  </div>

  <!-- Search Account by Account No -->
  <div class="oj-flex oj-sm-align-items-center" style="margin-bottom: 32px;">
    <oj-input-text id="searchAccountNo"
                   label-hint="Retrieve Account By Account No"
                   value="{{searchAccountNo}}"
                   style="width: 220px; margin-right: 12px;">
    </oj-input-text>
    <oj-button id="retrieveAccountBtn"
               chroming="callToAction"
               on-oj-action="[[retrieveAccountByNo]]">
      Retrieve Account
    </oj-button>
  </div>

  <!-- Account Summary Cards -->
  <div class="oj-flex oj-wrap oj-sm-margin-4x-bottom" data-bind="visible: !isLoading()">
    <div class="oj-flex-item oj-sm-12 oj-md-4 oj-sm-padding-2x">
      <div class="oj-panel oj-panel-alt1" style="text-align: center; padding: 20px;">
        <div style="color: #4CAF50; font-size: 28px; font-weight: bold;">
          [[accounts().length]]
        </div>
        <div style="color: #666; font-size: 14px;">Total Accounts</div>
      </div>
    </div>
    <div class="oj-flex-item oj-sm-12 oj-md-4 oj-sm-padding-2x">
      <div class="oj-panel oj-panel-alt1" style="text-align: center; padding: 20px;">
        <div style="color: #FF9800; font-size: 24px; font-weight: bold;">
          [[formatBalance(accounts().reduce((sum, acc) => sum + parseFloat(acc.accountBalance || 0), 0))]]
        </div>
        <div style="color: #666; font-size: 14px;">Total Balance</div>
      </div>
    </div>
    <div class="oj-flex-item oj-sm-12 oj-md-4 oj-sm-padding-2x">
      <div class="oj-panel oj-panel-alt1" style="text-align: center; padding: 20px;">
        <div style="color: #2196F3; font-size: 28px; font-weight: bold;">
          [[customers().length]]
        </div>
        <div style="color: #666; font-size: 14px;">Active Customers</div>
      </div>
    </div>
  </div>

  <!-- Loading Indicator -->
  <div data-bind="visible: isLoading()" style="text-align: center; padding: 40px;">
    <oj-progress-circle size="md"></oj-progress-circle>
    <p style="margin-top: 15px; color: #666;">Loading accounts...</p>
  </div>

  <!-- Error Message -->
  <oj-message-banner data-bind="visible: errorMessage().length > 0" 
                    type="error" 
                    summary="Error Loading Accounts"
                    detail="[[errorMessage]]"
                    style="margin-bottom: 20px;">
  </oj-message-banner>

  <!-- Accounts Table -->
  <div data-bind="visible: !isLoading() && accounts().length > 0">
    <oj-table id="accountsTable"
              aria-label="Accounts Table"
              data="[[accountsDataProvider]]"
              columns="[[columnArray]]"
              scroll-policy="loadMoreOnScroll"
              class="oj-table-stretch"
              style="width: 100%;">
      
      <!-- Account Type Template -->
      <template slot="accountTypeTemplate" data-oj-as="cell">
        <span class="account-type-badge" data-bind="css: cell.data.toLowerCase(), text: getAccountTypeLabel(cell.data)"></span>
      </template>

      <!-- Balance Template -->
      <template slot="balanceTemplate" data-oj-as="cell">
        <span class="balance-amount" data-bind="text: formatBalance(cell.data)"></span>
      </template>

      <!-- Customer Template -->
      <template slot="customerTemplate" data-oj-as="cell">
        <div class="customer-info">
          <div class="customer-avatar" data-bind="text: getCustomerName(cell.row.customerId).charAt(0).toUpperCase()"></div>
          <div>
            <div style="font-weight: 500;" data-bind="text: getCustomerName(cell.row.customerId)"></div>
            <div style="font-size: 12px; color: #666;" data-bind="text: 'ID: ' + cell.row.customerId"></div>
          </div>
        </div>
      </template>

      <!-- Action Template -->
      <template slot="actionTemplate" data-oj-as="cell">
        <div class="oj-flex oj-sm-flex-wrap oj-sm-justify-content-flex-end">
          <oj-button chroming="danger" 
                     size="sm" 
                     on-oj-action="[[deleteAccount]]"
                     title="Delete Account">
            <span slot="startIcon" class="oj-ux-ico-delete"></span>
            Delete
          </oj-button>
        </div>
      </template>
    </oj-table>
  </div>

  <!-- No Data Message -->
  <div data-bind="visible: !isLoading() && accounts().length === 0"
       style="text-align: center; padding: 60px; background: white; border-radius: 8px;">
    <span class="oj-ux-ico-credit-card"
          style="font-size: 64px; color: #ccc; display: block; margin-bottom: 20px;"></span>
    <h3 style="color: #666; margin-bottom: 10px;">No Accounts Found</h3>
    <p style="color: #999; margin-bottom: 20px;">
      Start by creating your first account for a customer.
    </p>
    <oj-button chroming="callToAction" on-oj-action="[[openAddDialog]]">
      <span slot="startIcon" class="oj-ux-ico-add"></span>
      Create First Account
    </oj-button>
  </div>

  <!-- Add Account Dialog -->
  <oj-dialog id="accountDialog"
             data-bind="ojDialog: {opened: showDialog()}"
             dialog-title="Create New Account"
             modality="modal"
             style="width: 500px; max-width: 90vw;">

    <div slot="body">
      <oj-form-layout label-edge="start" max-columns="1" style="padding: 20px;">

        <oj-select-single id="customerSelect"
                          label-hint="Customer *"
                          value="{{customerId}}"
                          placeholder="Select a customer"
                          required>
          <oj-option value="">-- Select Customer --</oj-option>
          <!-- ko foreach: customers -->
          <oj-option data-bind="value: $data.customerId, text: $data.name + ' (' + $data.email + ')'"></oj-option>
          <!-- /ko -->
        </oj-select-single>

        <oj-input-text id="accountHolderName"
                       label-hint="Account Holder Name *"
                       value="{{accountHolderName}}"
                       placeholder="Enter account holder name"
                       required
                       clear-icon="conditional">
          <oj-bind-slot name="help">
            <oj-help-hints definition="Name of the person holding this account"></oj-help-hints>
          </oj-bind-slot>
        </oj-input-text>

        <oj-select-single id="accountType"
                          label-hint="Account Type *"
                          value="{{accountType}}"
                          required>
          <!-- ko foreach: accountTypeOptions -->
          <oj-option data-bind="value: $data.value, text: $data.label"></oj-option>
          <!-- /ko -->
        </oj-select-single>

        <oj-input-number id="accountBalance"
                         label-hint="Initial Balance *"
                         value="{{accountBalance}}"
                         min="0"
                         step="0.01"
                         placeholder="0.00"
                         required>
          <oj-bind-slot name="converter">
            <oj-number-converter type="currency" currency-code="USD" currency-display="symbol"></oj-number-converter>
          </oj-bind-slot>
          <oj-bind-slot name="help">
            <oj-help-hints definition="Initial deposit amount for the account"></oj-help-hints>
          </oj-bind-slot>
        </oj-input-number>

      </oj-form-layout>
    </div>

    <div slot="footer" style="padding: 15px 20px;">
      <div class="oj-flex oj-sm-justify-content-flex-end">
        <oj-button id="cancelBtn"
                   chroming="outlined"
                   on-oj-action="[[closeDialog]]"
                   style="margin-right: 10px;">
          Cancel
        </oj-button>
        <oj-button id="saveBtn"
                   chroming="callToAction"
                   on-oj-action="[[saveAccount]]">
          <span slot="startIcon" class="oj-ux-ico-save"></span>
          Create Account
        </oj-button>
      </div>
    </div>
  </oj-dialog>
</div>

<!-- Custom Styles -->
<style>
  .account-type-badge {
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 500;
    text-transform: uppercase;
  }

  .account-type-badge.savings {
    background: #4CAF50;
    color: white;
  }

  .account-type-badge.current {
    background: #2196F3;
    color: white;
  }

  .balance-amount {
    font-weight: 600;
    color: #2E7D32;
  }

  .customer-info {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .customer-avatar {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: linear-gradient(135deg, #1565C0, #1976D2);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
    font-size: 14px;
  }

  @media (max-width: 768px) {
    .oj-table .oj-table-cell {
      padding: 8px 4px;
      font-size: 14px;
    }

    .customer-avatar {
      width: 28px;
      height: 28px;
      font-size: 12px;
    }
  }
</style>
